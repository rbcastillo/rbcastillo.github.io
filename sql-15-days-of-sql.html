<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <title>SQL | 15 days of learning SQL</title>
    <meta content="" name="description">
    <meta content="" name="keywords">
	
	<!-- Google Site Verification -->
    <meta name="google-site-verification" content="DCSbtcds2oWXGOsnqmm7Q_wLuvkTXY1h2-DgVP8euTg" />
	
	<!-- Favicons -->
    <link href="assets/img/RubenCloseupRound.png" rel="icon">
    <link href="assets/img/RubenCloseupRound.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|JetBrains+Mono" rel="stylesheet">
	
    <!-- Template Main CSS File -->
    <link href="assets/css/style.css" rel="stylesheet">
	<link href="assets/css/code-format.css" rel="stylesheet">
	
	<!-- highlight.js script to format code -->
	<script src="assets/js/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
	
	<!-- Load HTML template elements -->
	<script src="assets/js/add_header.js" type="text/javascript" defer></script> <!-- Header -->
	
	<!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
	

    <!-- =======================================================
    * Template Name: iPortfolio - v3.1.0
    * Template URL: https://bootstrapmade.com/iportfolio-bootstrap-portfolio-websites-template/
    * Author: BootstrapMade.com
    * License: https://bootstrapmade.com/license/
    ======================================================== -->
</head>

<body>

<!-- ======= Mobile nav toggle button ======= -->
<i class="bi bi-list-ul mobile-nav-toggle d-xl-none"></i>

<main id="main">

	<div class="challenge-description">
	<p>SQL | <span class="challenge-name">15 days of learning SQL</span></p>
	</div>
	
    <!-- ======= Challenge introduction section ======= -->
    <section id="challenge-introduction" class="challenge-section">
        <div class="container">

            <div class="section-title">
                <h2>Challenge introduction</h2>

                <p>This challenge offers a valuable exercise in constructing <strong>complex queries</strong>, <strong>aggregating</strong> and <strong>transforming 
				data</strong>, <strong>working with dates</strong> and generating <strong>running statistics</strong>. This problem enhances SQL skills, especially 
				in areas like CTEs, JOIN operations, window functions and data aggregation. These skills are useful in real-world scenarios, where data from multiple 
				sources needs <strong>consolidation and analysis</strong>.</p>
				
				<p>The problem is sourced from <strong>HackerRank</strong> and is available at the following 
				<strong><a href="https://www.hackerrank.com/challenges/15-days-of-learning-sql/problem" target="_blank" style="color:#02CE55;">link</a></strong>. 
				I recommend attempting to solve the challenge independently before reviewing the provided solution.</p>


            </div>

        </div>
    </section><!-- End challenge introduction section -->
	
	<!-- ======= Problem statement section ======= -->
    <section id="problem-statement" class="challenge-section">
        <div class="container">

            <div class="section-title">
                <h2>Problem statement</h2>

                <p>Julia conducted a 15 days of learning SQL contest. The start date of the contest was March 01, 2016 and the end date was March 15, 2016.</p>
				<p>Write a query to print <strong>total number of unique hackers</strong> who made at <strong>least one submission each day</strong> (starting on 
				the first day of the contest), and find the <strong>hacker_id</strong> and <strong>name</strong> of the hacker who made maximum number of 
				submissions each day. If more than one such hacker has a maximum number of submissions, print the lowest hacker_id. The query should print this 
				information for each day of the contest, sorted by the date.</p>
				
				<p><strong>Input format</strong>.</br>The data needed for this challenge is spread across the following tables:</p>
				
				<div>  <!-- ======= Start hackers table ======= -->
					<table class="columns-table">
						<thead>
							<th>Column</th><th>Type</th>					
						</thead>
						<tbody>
							<tr><td>hacker_id</td><td>Integer</td></tr>
							<tr><td>name</td><td>String</td></tr>
						</tbody>
					</table>
					<span class="table-explanation">
						<p><strong>hackers</strong></p>
						<p>The hacker_id is the id of the hacker, and name is the name of the hacker</p>
					</span>
				</div>  <!-- ======= End hackers table ======= -->
				
				<div>  <!-- ======= Start submissions table ======= -->
					<table class="columns-table">
						<thead>
							<th>Column</th><th>Type</th>					
						</thead>
						<tbody>
							<tr><td>submission_date</td><td>Date</td></tr>
							<tr><td>submission_id</td><td>Integer</td></tr>
							<tr><td>hacker_id</td><td>Integer</td></tr>
							<tr><td>score</td><td>Integer</td></tr>
						</tbody>
					</table>
					<span class="table-explanation">
						<p><strong>submissions</strong></p>
						<p>The submission_date is the date of the submission, submission_id is the id of the submission, 
						hacker_id is the id of the hacker who made the submission, and score is the score of the submission. </p>
					</span>
				</div>  <!-- ======= End submissions table ======= -->
				
				<p style="clear: both;padding-top: 2%;"><strong>Sample input</strong>.</p>
				<p>Take as an example (assuming that the end date of the contest was March 06, 2016) the data contained in the following tables:</p>
				
				<!-- ================================================== Start example tables ================================================== -->
				<!-- ================================================== -------------------- ================================================== -->
				
				<div>
					<table class="examples-table table-small"><!-- ======= Start hackers table ======= -->
						<thead>
							<th>hacker_id</th><th>name</th>
						</thead>
						<tbody>
							<tr><td>15758</td><td>Rose</td></tr>
							<tr><td>20703</td><td>Angela</td></tr>
							<tr><td>36396</td><td>Frank</td></tr>
							<tr><td>38289</td><td>Patrick</td></tr>
							<tr><td>44065</td><td>Lisa</td></tr>
							<tr><td>53473</td><td>Kimberly</td></tr>
							<tr><td>62529</td><td>Bonnie</td></tr>
							<tr><td>79722</td><td>Michael</td></tr>
						</tbody>
					</table><!-- ======= End hackers table ======= -->
				
					<table class="examples-table table-small"><!-- ======= Start submissions table ======= -->
						<thead>
							<th>submission_date</th><th>submission_id</th><th>hacker_id</th><th>score</th>
						</thead>
						<tbody>
							<tr><td>2016-03-01</td><td>8494</td><td>20703</td><td>0</td></tr>
							<tr><td>2016-03-01</td><td>22403</td><td>53473</td><td>15</td></tr>
							<tr><td>2016-03-01</td><td>23965</td><td>79722</td><td>60</td></tr>
							<tr><td>2016-03-01</td><td>30173</td><td>36396</td><td>70</td></tr>
							<tr><td>2016-03-02</td><td>34928</td><td>20703</td><td>0</td></tr>
							<tr><td>2016-03-02</td><td>38740</td><td>15758</td><td>60</td></tr>
							<tr><td>2016-03-02</td><td>42769</td><td>79722</td><td>25</td></tr>
							<tr><td>2016-03-02</td><td>44364</td><td>79722</td><td>60</td></tr>
							<tr><td>2016-03-03</td><td>45440</td><td>20703</td><td>0</td></tr>
							<tr><td>2016-03-03</td><td>49050</td><td>36396</td><td>70</td></tr>
							<tr><td>2016-03-03</td><td>50273</td><td>79722</td><td>5</td></tr>
							<tr><td>2016-03-04</td><td>50344</td><td>20703</td><td>0</td></tr>
							<tr><td>2016-03-04</td><td>51360</td><td>44065</td><td>90</td></tr>
							<tr><td>2016-03-04</td><td>54404</td><td>53473</td><td>65</td></tr>
							<tr><td>2016-03-04</td><td>61533</td><td>79722</td><td>45</td></tr>
							<tr><td>2016-03-05</td><td>72852</td><td>20703</td><td>0</td></tr>
							<tr><td>2016-03-05</td><td>74546</td><td>38289</td><td>0</td></tr>
							<tr><td>2016-03-05</td><td>76487</td><td>62529</td><td>0</td></tr>
							<tr><td>2016-03-05</td><td>82439</td><td>36396</td><td>10</td></tr>
							<tr><td>2016-03-05</td><td>90006</td><td>36396</td><td>40</td></tr>
							<tr><td>2016-03-06</td><td>90404</td><td>20703</td><td>0</td></tr>
						</tbody>
					</table><!-- ======= End submissions table ======= -->
				
				</div>
				
				<p><strong>Expected output</strong>.</p>
				<p>The expected output given the sample input is the following:</p>
				
				<table class="examples-table table-narrow"><!-- ======= Start expected output table ======= -->
					<tbody>
						<tr><td>2016-03-01<td><td>4<td><td>20703<td><td>Angela<td></tr>
						<tr><td>2016-03-02<td><td>2<td><td>79722<td><td>Michael<td></tr>
						<tr><td>2016-03-03<td><td>2<td><td>20703<td><td>Angela<td></tr>
						<tr><td>2016-03-04<td><td>2<td><td>20703<td><td>Angela<td></tr>
						<tr><td>2016-03-05<td><td>1<td><td>36396<td><td>Frank<td></tr>
						<tr><td>2016-03-06<td><td>1<td><td>20703<td><td>Angela<td></tr>
					</tbody>
				</table><!-- ======= End expected output table ======= -->
				
				<p><strong>Explanation</strong>.</p>
				<p>On March 01, 2016 hackers <strong>20703</strong>, <strong>36396</strong>, <strong>53473</strong>, and <strong>79722</strong> made submissions. 
				There are <strong>4</strong> unique hackers who made at least one submission each day. As each hacker made one submission, <strong>20703</strong> 
				is considered to be the hacker who made maximum number of submissions on this day. The name of the hacker is <strong>Angela</strong>.</p>
				
				<p>On March 02, 2016 hackers <strong>15758</strong>, <strong>20703</strong>, and <strong>79722</strong> made submissions. Now <strong>20703</strong> 
				and <strong>79722</strong> were the only ones to submit every day, so there are <strong>2</strong> unique hackers who made at least one submission 
				each day. <strong>79722</strong> made two submissions, and name of the hacker is <strong>Michael</strong>.</p>
				
				<p>On March 03, 2016 hackers <strong>20703</strong>, <strong>36396</strong>, and <strong>79722</strong> made submissions. Now <strong>20703</strong> 
				and <strong>79722</strong> were the only ones, so there are <strong>2</strong> unique hackers who made at least one submission each day. As each hacker 
				made one submission, <strong>20703</strong> is considered to be the hacker who made maximum number of submissions on this day. The name of the hacker 
				is <strong>Angela</strong>.</p>
				
				<p>On March 04, 2016 hackers <strong>20703</strong>, <strong>36396</strong>, <strong>38289</strong>, and <strong>65529</strong>made submissions. 
				Now only <strong>20703</strong> and <strong>79722</strong> submitted each day, so there are <strong>2</strong> unique hackers who made at least one 
				submission each day. As each hacker made one submission, <strong>20703</strong> is considered to be the hacker who made maximum number of submissions 
				on this day. The name of the hacker is <strong>Angela</strong>.</p>
				
				<p>On March 05, 2016 hackers <strong>20703</strong>, <strong>36396</strong>, <strong>38289</strong> and <strong>65529</strong> made submissions. 
				Now only <strong>20703</strong> submitted each day, so there is only <strong>1</strong> unique hacker who made at least one submission each day.
				<strong>36396</strong> made two submissions and name of the hacker is <strong>Frank</strong>.</p>
				
				<p>On March 06, 2016 only <strong>20703</strong> made a submission, so there is only <strong>1</strong> unique hacker who made at least one submission 
				each day. <strong>20703</strong> made one submission and the name of the hacker is <strong>Angela</strong>.</p>

            </div>

        </div>
    </section><!-- End problem statement section -->

	<!-- ======= Solution section ======= -->
    <section id="solution" class="challenge-section">
        <div class="container">

            <div class="section-title">
                <h2>Solution</h2>

                <p>To approach this problem effectively, it's crucial to recognize that it involves <strong>two distinct challenges</strong>, each requiring 
				a different set of logical skills. However, both complexities can be simplified by initially aggregating the submission data by date and hacker, 
				creating a foundational <strong>auxiliary table</strong> for subsequent operations.</p>
				
				<p>The first, more straightforward challenge involves identifying the hacker with the most submissions each day. This can be accomplished by 
				<strong>sorting hackers within each date</strong> based on submission counts descending and hacker IDs ascending, consistently selecting the top-ranked 
				hacker for each submission date block.</p>
				
				<p>Conversely, the second challenge, which demands tracking the count of hackers submitting daily, is more intricate. To tackle this, the chosen 
				approach utilizes <strong>window functions</strong> to streamline the task of calculating consecutive submission days for each hacker. This involves 
				employing DENSE_RANK to determine the index of the submission day's and comparing it to the ROW_NUMBER for a given hacker_id for this date. It's 
				important to note that this approach assumes <strong>at least one hacker submits every day</strong>; otherwise, DENSE_RANK may not function as intended. 
				Additionally, while DATEPART could replace DENSE_RANK under the specific conditions of this problem where dates begin at the month's first day, 
				it would result in a <strong>less versatile solution</strong> that would not work if start or end dates change.</p>
				
				<p>Finally, the solution <strong>integrates all components</strong> and <strong>incorporates the hackers' table</strong> to extract their names, 
				completing the task.</p>
				
				<pre><code class="sql">
-- Generate auxiliary CTEs
WITH daily_subs AS (
        SELECT hacker_id, submission_date, COUNT(*) AS num_subs
        FROM submissions
        GROUP BY hacker_id, submission_date),
    
    all_days_subs AS (
        SELECT submission_date, hacker_id
        FROM (SELECT submission_date, 
                     hacker_id,
                     DENSE_RANK() OVER(ORDER BY submission_date ASC) AS day_num, 
                     ROW_NUMBER() OVER (PARTITION BY hacker_id
                                        ORDER BY submission_date ASC) AS streak
              FROM daily_subs) AS streak_check
        WHERE day_num = streak),
        
    num_all_day_subs AS (
        SELECT submission_date, COUNT(*) AS num_subs
        FROM all_days_subs
        GROUP BY submission_date),
    
    daily_ranking AS (
        SELECT submission_date, hacker_id,
               ROW_NUMBER() OVER(PARTITION BY submission_date 
                                 ORDER BY num_subs DESC, hacker_id ASC) AS rank
        FROM daily_subs),
    
    daily_winners AS (
        SELECT submission_date, hacker_id
        FROM daily_ranking
        WHERE rank = 1)

-- Main query
SELECT ads.submission_date, num_subs, h.hacker_id, name
FROM num_all_day_subs AS ads
LEFT JOIN daily_winners AS dw
    ON ads.submission_date = dw.submission_date
LEFT JOIN hackers as h
    ON dw.hacker_id = h.hacker_id
ORDER BY ads.submission_date ASC;
				</code></pre>
				
            </div>

        </div>
    </section><!-- End solution section -->
	
</main>

<!-- Template Main JS File -->
<script src="assets/js/main.js"></script>

</body>

</html>